## Сервер данных сердец

Для того чтобы сцена визуализации viewlang могла получать данные с вычислителя, на нем должен работать специальный сервер данных. 

Сервер предоставляет функции:
* поиск каталогов сердец
* http-доступ к файлам данных на вычислителе.

## Важно 
Подразумевается, что все последующие команды выполняются пользователем по ssh-сессии на вычислителе.

Поиск и раздача файлов начинается от текущего каталога на момент запуска сервера.
Поэтому его целесообразно запускать в `домашнем` каталоге пользователя или глубже.

## Подготовка к запуску

Установить необходимые руби-пакеты, выполнив нижеследующие команды. Это действие проводится однократно.

```
gem install sinatra --user-install --no-ri --no-rdoc
gem install json --user-install --no-ri --no-rdoc
gem install thin --user-install --no-ri --no-rdoc
gem install sinatra-contrib --user-install --no-ri --no-rdoc
```

## Имена файлов с данными

Файл с координатами вершин coord.txt
Файл с триангуляцией поверхности ЛЖ triangles.txt
Файл с данными в узлах voltage_.json (пока загружаю только занные о потенциале - вольтаж)
Файл с филаментами tipsHans.info

## Временный запуск
Команда запуска:
```
ruby /misc/home/u1321/heartsrv1/heart-server-1.rb
```
Примечания. 
* Сервер уже размещен на машине UMT в каталоге `/misc/home/u1321/heartsrv1/`. Также сервер можно скачать из этого репозитория, файл [heart-server-1.rb](heart-server-1.rb)
* Можно указать аргумент - номер порта. По умолчанию это 7000.
* Остановка сервера во временном запуске - Ctrl+C

## Постоянный запуск
Если требуется, чтобы сервер работал и после завершения SSH-сессии связи с UMT, команда запуска с амперсандом на конце:
```
ruby /misc/home/u1321/heartsrv1/heart-server-1.rb &
```

## Остановка
Алгоритм остановки сервера, запущенного в постоянном режиме:
```
ps ax|grep ruby
# найти глазами <айди процесса сервера>
kill <этот айди>
```
Альтернативный экстренный метод остановки сервера: в браузере сделать запрос к адресу `http://umt.imm.uran.ru:7000/stop`. Это останавливает процесс сервера, запущенного от любого пользователя.

## Взаимодействие с сервером
Когда сервер работает, в диалоге "Загрузка данных.." доступна вкладка "Суперкомпьютер". 
* Кнопка `Опросить` формирует обращение к серверу на поиск данных. По окончании поиска отображается список найденных каталогов и предлагается выбрать один из них.
* Кнопка `Загрузить выбор` - подает команду на загрузку выбранных данных.

2015 Павел Васёв
